version: "1.0"
name: "Darkwood2 Development Pipeline"
description: "End-to-end workflow for survival horror RPG with AI director and transparent systems"

phases:
  - name: "initialization"
    steps:
      - action: "repo_setup"
        config:
          structure:
            - "src/"
            - "assets/"
            - "schemas/"
            - "ledger/"
            - "docs/"
            - ".github/workflows/"
            - "tools/"

      - action: "file_creation"
        files:
          - path: "README.md"
            content: |
              # Darkwood2
              A survival-horror, narrative-first RPG with capability-driven progression.

              ## Vision
              - Capability-driven progression (verbs/affordances)
              - Runtime AI director for tension pacing
              - Fully transparent, audit-logged workflows

          - path: ".github/workflows/ci.yml"
            content: |
              name: ci-validate-and-audit
              on: [push, pull_request]
              jobs:
                validate:
                  runs-on: ubuntu-latest
                  steps:
                    - uses: actions/checkout@v4
                    - run: npm ci
                    - run: npm test
                    - run: |
                        echo "${{ github.sha }}" > ledger/build_seed.txt
                        cat ledger/build_seed.txt

  - name: "core_systems"
    steps:
      - action: "system_scaffold"
        components:
          - name: "world_gen"
            path: "src/world/"
            files:
              - "terrain.aln"
              - "biome_rules.aii"

          - name: "ai_director"
            path: "src/ai/"
            files:
              - "tension.aln"
              - "behavior_trees.aii"

  - name: "compliance"
    steps:
      - action: "schema_creation"
        schemas:
          - name: "asset_schema"
            path: "schemas/asset.schema.json"
            validation: "strict"

      - action: "ledger_setup"
        config:
          log_file: "ledger/events.jsonl"
          required_fields: ["timestamp", "actor", "action", "seed"]

  - name: "development"
    steps:
      - action: "asset_pipeline"
        config:
          input: "assets/raw/"
          output: "assets/processed/"
          validation:
            - "schema_validation"
            - "checksum_verification"

      - action: "ai_integration"
        config:
          models:
            - name: "tension_model"
              path: "models/tension.pth"
              validation: "ethics_approved"

  - name: "deployment"
    steps:
      - action: "remote_desktop"
        config:
          platforms:
            - name: "novnc"
              command: "docker run -d -p 6080:80 dorowu/ubuntu-desktop-lxde-vnc"
              env_vars:
                - "SWARM_TAG=darkwood2"
                - "SWARM_SEED=${{ github.sha }}"

      - action: "web_deployment"
        config:
          target: "github_pages"
          source: "dist/"
          validation: "content_security"

  - name: "continuous_integration"
    steps:
      - action: "ci_setup"
        config:
          workflow: ".github/workflows/ci.yml"
          triggers:
            - "push"
            - "pull_request"

      - action: "audit_system"
        config:
          log_file: "ledger/audit.log"
          required: true

contributors:
  - name: "J.S. Farmer"
    role: "Lead Developer"
    responsibilities:
      - "Narrative Systems"
      - "Compliance Steward"

  - name: "AI Systems"
    role: "Collaborators"
    attribution: "event-based"

validation_rules:
  - type: "schema"
    pattern: "schemas/*.schema.json"
    enforcement: "strict"

  - type: "compliance"
    pattern: "ledger/*.jsonl"
    fields:
      - "timestamp"
      - "actor"
      - "action"
      - "seed"

environment:
  node_version: "18"
  python_version: "3.9"
  dotnet_version: "6.0"

documentation:
  - path: "docs/CONTRIBUTING.md"
    content: |
      # Contribution Guidelines
      - All PRs require schema-valid assets
      - Include deterministic seeds for testing
      - Commit messages must have intent tags

  - path: "docs/ARCHITECTURE.md"
    content: |
      # System Architecture
      ## Core Components
      - World Generation (ALN-based)
      - AI Director (Behavior Trees)
      - Capability System (Verb-driven)
